# /etc/nginx/conf.d/facegate.conf
server {
  listen 80;
  server_name your.domain;
  # return 301 https://$host$request_uri;  # 打开后强制 https
}

server {
  listen 443 ssl http2;
  server_name your.domain;

  # ssl_certificate /etc/letsencrypt/live/your.domain/fullchain.pem;
  # ssl_certificate_key /etc/letsencrypt/live/your.domain/privkey.pem;

  # Admin 前端 -> admin:5173
  location / {
    proxy_pass http://admin:5173;
    proxy_http_version 1.1;
  }

  # REST API -> api:3001
  location /api/ {
    proxy_pass http://api:3001;
    proxy_http_version 1.1;
  }

  # WebSocket -> api:7001
  location /ws/ {
    proxy_pass http://api:7001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
    proxy_read_timeout 300s;
    proxy_send_timeout 300s;
  }
}
